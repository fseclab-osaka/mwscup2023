# Zk4Log
ZK4Logは、ログを秘匿化したりゼロ知識証明を用いて秘匿化されたログが改竄されていないことを確認できるツールです。
また、簡単なログのビュアーを提供するツールになります。

## 目次
- [Zk4Log](#zk4log)
  - [目次](#目次)
  - [インストール方法](#インストール方法)
  - [機能と使用方法](#機能と使用方法)
    - [ログの秘匿化とproofの生成](#ログの秘匿化とproofの生成)
    - [秘匿化されたログの認証](#秘匿化されたログの認証)
    - [ログのビュアー](#ログのビュアー)

## インストール方法
本ツールは[Nushell](https://www.nushell.sh/ja/)のプラグインであるため、Nushellが必要となります。[インストール方法](https://www.nushell.sh/ja/book/installation.html)を参考にNushellのインストールをしてください。

1. ソースコードを手元にインストールをし、ビルドします。
   本プログラムはRustで記述されており、本手順ではビルドにcargoを使用します。cargoが未インストールの場合は別途インストールしてください。(https://doc.rust-lang.org/cargo/getting-started/installation.html)
   ```
   git clone https://github.com/fseclab-osaka/mwscup2023.git
   cd mws2023/zk4log
   cargo build
   ```

2. Nushellを起動する。
   ```
   nu
   ```

3. ビルドした実行ファイルをプラグインとして追加する。
   ```
   cd target/debug
   register ./nu_plugin_zk4log
   ```

## 機能と使用方法
本ツールは3つの機能を提供しています。これらの機能はNushell上で実行されるため、上記の手順でプラグインが追加されたNushell上で実行してください。

### ログの秘匿化とproofの生成
  本ツールでは、json化されたログファイルを入力し、秘匿化したいカラムを選択することで、秘匿化されたログと正しいことを証明する際に使用されるproofファイル、及びゼロ知識証明に使用した鍵が書かれたファイルの3つを生成することができます。

  1. 以下のコマンドを実行する。
  ```
  zk4log hide [秘匿化するログファイル名]
  ```
  2. ログファイルに含まれるカラムの一覧が表示されるため、秘匿化したいカラムを選択する。選択では十字キーの上下でカーソルの移動、スペースキーで選択、Enterキーで決定ができます。
  3. 秘匿化されたログファイルとproofが生成されます。(ゼロ知識証明を実行しているため、本処理には時間がかかります)

### 秘匿化されたログの認証
  秘匿化されたログファイルとそれに対するproof、鍵の3つを与えることで、秘匿化されたログが正しいことや改竄されていないことを確認できます。

  実行には以下のコマンドを実行してください。
  ```
  zk4log verify -j [秘匿化されたログファイル名] -p [proofファイル名] -k [鍵ファイル名]
  ```

### ログのビュアー
  json形式のログファイルに対するビュアーです。
  インタラクティブに表示したいカラムのみを選択し、表示させることができます。
  1. 以下のコマンドを実行します。
   ```
   zk4log open [ログファイル名]
   ```
  2. ログファイルに含まれるカラムの一覧が表示されるため、表示したいカラムを選択する。選択では十字キーの上下でカーソルの移動、スペースキーで選択、Enterキーで決定ができます。
  3. 選択したカラムのみが一覧で表示されます。